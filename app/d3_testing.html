<!DOCTYPE html>


<html>
<head>
<style>

/*.chart div {
  font: 10px sans-serif;
  background-color: steelblue;
  text-align: right;
  padding: 3px;
  margin: 1px;
  color: white;
}*/

.bar {
  fill: steelblue;
}

.bar:hover{

    fill:darkblue;
}
text {
  font: 10px sans-serif;
  color: #061235;
}

.axis path,
.axis line {
  fill: none;
  stroke: #061235;
  shape-rendering: crispEdges;
}

/*.x.axis path{
    display:none;
}

.y.axis*/

div.tooltip {
    position: absolute;
    text-align: center;
    width: 100px;
    height: 28px;
    padding: 2px;
    font: 12px sans-serif;
    background: lightsteelblue;
    border: 0px;
/*    border-radius: 8px;
*/    pointer-events: none;
}

.total_rainfall{

    /*fill:red;*/
}

.rainfall_bar{

    fill:lightblue;
}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>

</head>
<body>
<!--     <div class="chart"></div>
 -->
    <svg class="chart"></svg>
    <svg class="total_rainfall"></svg>
    <p class="rainfall_message"></p>
    <script>
        var data = {"2015-02-04": 0.01, "2015-02-05": 0.845, "2015-02-06": 0.01, "2015-02-07": 0.01, "2015-02-08": 0.01, "2015-02-09": 5.654, "2015-02-10": 3.436, "2015-02-11": 0.01, "2015-02-12": 3.284, "2015-02-13": 0.01, "2015-02-14": 0.01, "2015-02-15": 0.01, "2015-02-16": 0.01, "2015-02-17": 8.498, "2015-02-18": 0.737, "2015-02-19": 0.01, "2015-02-20": 0.01, "2015-02-21": 0.01, "2015-02-22": 11.666, "2015-02-23": 0.884, "2015-02-24": 0.01, "2015-02-25": 0.01, "2015-02-26": 31.581, "2015-02-27": 0.01, "2015-02-28": 0.01, "2015-03-01": 0.01, "2015-03-02": 14.629, "2015-03-03": 0.01, "2015-03-04": 27.571, "2015-03-05": 47.464, "2015-03-06": 2.619, "2015-03-07": 0.01, "2015-03-08": 0.01}

        var rainfall = [];
        var parseDate = d3.time.format("%Y-%m-%d").parse;


        for(var o in data){
            rainfall.push(Math.round(data[o]))
        }

        // var dates = Object.keys(data)
        var dates= []
        for ( var p in data){

            dates.push(parseDate(p));
        }

        var dateFormat = d3.time.format("%e %b %Y");

        var margin = {top: 70, right: 30, bottom: 70, left: 40},
            width = 500 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;
            // barWidth = width/rainfall.length;

        var x = d3.scale.ordinal()
                .domain(dates)
                .rangeBands([0,width], 0.1)
                 //calculates spacing of x axis; adds padding between bars

        var y = d3.scale.linear()
                .domain([0, d3.max(rainfall)])
                .range([height, 0]);

        var xAxis = d3.svg.axis()
                    .scale(x)
                    .tickValues(x.domain().filter(function(d, i) { return !(i % 7); }))
                    .tickFormat(dateFormat)
                    .orient("bottom")

        var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left");

        // Define the div for the tooltip
        var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

        var chart = d3.select(".chart")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        chart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
        .selectAll("text") //rotates x axis lables
        .attr("y", 9)
        .attr("x", 6)
        .attr("dy", ".35em")
        .attr("transform", "rotate(45)")
        .style("text-anchor", "start");

        chart.append("g")
        .attr("class", "y axis")
        .call(yAxis);

        chart.selectAll(".bar")
            .data(rainfall)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("y", function(d){ return height })
            .attr("rainfall", function(d){return d})
            .attr("height", 0)
            .attr("width", x.rangeBand())
            .transition()
            .attr("y", function(d){return y(d)})
            .attr("height",function(d){return height - y(d);})
            .duration(500)

        chart.selectAll("rect")
            .data(dates)
            .attr("x", function(d){return x(d)})
            .on("mouseover", function(d){
                div.transition()
                    .style("opacity",1);
                div.html(dateFormat(d) +  "<br>" + d3.select(this).attr("rainfall") + "mm")
                    .style("left", width/2  +"px")
                    .style("top", 20 + "px")
            })
            .on("mouseout", function(d){

                div.transition()
                    .style("opacity", 0)
            });

        var chart2 = d3.select(".total_rainfall")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

        var total_x = d3.scale.linear()
                    .domain([0, 30*rainfall.length])
                    .range([0, width]);

        var total_xAxis = d3.svg.axis()
        .scale(total_x)
        .orient("top");

        chart2.append("g")
                .attr("class", "x axis")
                .call(total_xAxis)
        var total_rainfall = d3.sum(rainfall);
        var rainfall_bar = chart2.append("rect")
                                    .attr("width", 0)
                                    .attr("height", 25)
                                    .attr("class", "rainfall_bar")
                                    .attr("transform", "translate(0,5)")
                                    .transition()
                                    .attr("width", total_x(total_rainfall))
                                    .duration(5000)
        chart2.append("text")
                .text(0)
                .attr("class", "text")
                .attr("x", 5)
                .attr("y", d3.select(".rainfall_bar").attr("height")/2 + 5)
                .transition()
                .duration(5000)
                .attr("x", total_x(total_rainfall)+ 5)
                .tween("text", function(){

                    var i = d3.interpolateRound(0,total_rainfall);
                    return function(t){

                        this.textContent = "Total rainfall: " + i(t) + " mm"
                    }
                })

        // var rainfall_message = d3.select(".rainfall_message")
        //                         .html(0)
        //                         .transition()
        //                         .html(d3.select(".rainfall_bar").attr("width"))

    </script>





</body>
</html>





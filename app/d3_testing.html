<!DOCTYPE html>


<html>
<head>
<style>

/*.chart div {
  font: 10px sans-serif;
  background-color: steelblue;
  text-align: right;
  padding: 3px;
  margin: 1px;
  color: white;
}*/

.bar {
  fill: steelblue;
}

.bar:hover{

    fill:darkblue;
}
text {
  font: 10px sans-serif;
  color: #061235;
}

.axis path,
.axis line {
  fill: none;
  stroke: #061235;
  shape-rendering: crispEdges;
}

div.tooltip {
    position: absolute;
    text-align: center;
    width: 100px;
    height: 28px;
    padding: 2px;
    font: 10px sans-serif;
    background: lightsteelblue;
    border: 0px;
    pointer-events: none;
}

.rainfall_bar{

    fill:lightblue;
}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>

</head>
<body>
    <svg class="chart"></svg>
    <svg class="total_rainfall"></svg>
    <p class="rainfall_message"></p>
    <script>
        var data = {"2015-06-26": 13.363, "2015-06-27": 1.059, "2015-06-28": 2.286, "2015-06-29": 0.01, "2015-06-30": 0.01, "2015-07-01": 0.01, "2015-07-02": 65.16, "2015-07-03": 1.328, "2015-07-04": 1.521, "2015-07-05": 0.01, "2015-07-06": 0.01, "2015-07-07": 0.01, "2015-07-08": 0.01, "2015-07-09": 0.01, "2015-07-10": 0.01, "2015-07-11": 0.01, "2015-07-12": 0.01, "2015-07-13": 0.01, "2015-07-14": 3.0, "2015-07-15": 0.737, "2015-07-16": 26.35, "2015-07-17": 0.01, "2015-07-18": 0.01, "2015-07-19": 0.01, "2015-07-20": 0.01, "2015-07-21": 0.092, "2015-07-22": 0.01, "2015-07-23": 0.01, "2015-07-24": 0.01, "2015-07-25": 0.01, "2015-07-26": 0.01, "2015-07-27": 0.01, "2015-07-28": 0.01, "2015-07-29": 0.01, "2015-07-30": 0.01, "2015-07-31": 4.936, "2015-08-01": 0.01, "2015-08-02": 0.01, "2015-08-03": 0.01, "2015-08-04": 0.01, "2015-08-05": 1.666, "2015-08-06": 0.01, "2015-08-07": 36.175, "2015-08-08": 0.01, "2015-08-09": 9.734, "2015-08-10": 0.01, "2015-08-11": 19.194, "2015-08-12": 0.01, "2015-08-13": 0.01, "2015-08-14": 0.01, "2015-08-15": 0.01, "2015-08-16": 0.01, "2015-08-17": 0.01, "2015-08-18": 0.01, "2015-08-19": 0.01, "2015-08-20": 0.01, "2015-08-21": 0.01, "2015-08-22": 0.01, "2015-08-23": 0.01, "2015-08-24": 0.298, "2015-08-25": 0.01, "2015-08-26": 28.847, "2015-08-27": 0.01, "2015-08-28": 0.01, "2015-08-29": 0.01, "2015-08-30": 0.01, "2015-08-31": 0.01, "2015-09-01": 0.01, "2015-09-02": 0.01, "2015-09-03": 0.01, "2015-09-04": 0.01, "2015-09-05": 0.01, "2015-09-06": 0.01, "2015-09-07": 0.01, "2015-09-08": 0.01, "2015-09-09": 0.01, "2015-09-10": 2.503, "2015-09-11": 54.368, "2015-09-12": 0.238, "2015-09-13": 12.771, "2015-09-14": 0.01, "2015-09-15": 0.01, "2015-09-16": 0.01, "2015-09-17": 0.01, "2015-09-18": 0.01, "2015-09-19": 0.01, "2015-09-20": 0.01, "2015-09-21": 0.01, "2015-09-22": 0.01, "2015-09-23": 0.01, "2015-09-24": 0.01, "2015-09-25": 0.01, "2015-09-26": 1.159, "2015-09-27": 0.01, "2015-09-28": 0.01, "2015-09-29": 0.01}
        var rainfall = [];
        var parseDate = d3.time.format("%Y-%m-%d").parse;
        var dateFormat = d3.time.format("%e %b %Y");

        for(var o in data){
            rainfall.push(Math.round(data[o]))
        }

        var dates= [];
        for ( var p in data){

            dates.push(parseDate(p));
        };

        var margin = {top: 70, right: 30, bottom: 70, left: 40},
            width = 500 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;

        var x = d3.scale.ordinal()
                .domain(dates)
                .rangeBands([0,width], 0.1) //calculates spacing of x axis; adds padding between bars

        var y = d3.scale.linear()
                .domain([0, d3.max(rainfall)])
                .range([height, 0]);

        var xAxis = d3.svg.axis()
                    .scale(x)
                    .tickValues(x.domain().filter(function(d, i) { return !(i % 7); }))
                    .tickFormat(dateFormat)
                    .orient("bottom")

        var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left");

        // Define the div for the tooltip
        var tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

        var chart = d3.select(".chart")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        chart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
        .selectAll("text") //rotates x axis lables
        .attr("y", 9)
        .attr("x", 6)
        .attr("dy", ".35em")
        .attr("transform", "rotate(45)")
        .style("text-anchor", "start");

        chart.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(90)")
        .attr("dy", "-.5em")
        .text("Rainfall (mm)");

        chart.selectAll(".bar")
            .data(rainfall)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("y", function(d){ return height })
            .attr("rainfall", function(d){return d})
            .attr("height", 0)
            .attr("width", x.rangeBand())
            .transition()
            .attr("y", function(d){return y(d)})
            .attr("height",function(d){return height - y(d);})
            .duration(500)

        chart.selectAll("rect")
            .data(dates)
            .attr("x", function(d){return x(d)})

            .on("mouseover", function(d){
                tooltip.transition()
                    .style("opacity",1)
                tooltip.html(dateFormat(d) +  "<br>" + d3.select(this).attr("rainfall") + "mm")
                    .style("left", width/2  +"px")
                    .style("top", 20 + "px")
            })
            .on("mouseout", function(d){

                tooltip.transition()
                    .style("opacity", 0)
            });

        var chart2 = d3.select(".total_rainfall")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height/2 + margin.top/2 + margin.bottom/2)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top/2 + ")")

        var total_x = d3.scale.linear()
                    .domain([0, 30*rainfall.length])
                    .range([0, width]);

        var total_xAxis = d3.svg.axis()
        .scale(total_x)
        .orient("top");

        chart2.append("g")
                .attr("class", "x axis")
                .call(total_xAxis)
        var total_rainfall = d3.sum(rainfall);
        var rainfall_bar = chart2.append("rect")
                                    .attr("width", 0)
                                    .attr("height", 25)
                                    .attr("class", "rainfall_bar")
                                    .attr("transform", "translate(0,5)")
                                    .transition()
                                    .attr("width", total_x(total_rainfall))
                                    .duration(5000)
        chart2.append("text")
                .text(0)
                .attr("class", "text")
                .attr("x", 5)
                .attr("y", d3.select(".rainfall_bar").attr("height")/2 + 5)
                .transition()
                .duration(5000)
                .attr("x", total_x(total_rainfall)+ 5)
                .tween("text", function(){

                    var i = d3.interpolateRound(0,total_rainfall);
                    return function(t){

                        this.textContent = "Total rainfall: " + i(t) + " mm"
                    }
                })


    </script>





</body>
</html>




